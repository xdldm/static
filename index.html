<!DOCTYPE html>
<!-- saved from url=(0116)https://xgpt.wxc.edu.cn/phone/askForLeave/askForLeaveList.html?key=c3a7db72b64440ef5a4b282e5c3134fd&ts=1662218703463 -->
<html style="font-size: 52.0533px;" class="pixel-ratio-1" xmlns="http://www.w3.org/1999/html"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <title>请销假申请列表</title>
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta content="telephone=no" name="format-detection">
    <meta content="email=no" name="format-detection">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="./index_files/layui.css">
    <link rel="stylesheet" href="./index_files/weui.min.css">
    <link rel="stylesheet" href="./index_files/jquery-weui.css">
    <link rel="stylesheet" href="./index_files/phone.css">
    <script src="./index_files/rem.js.下载" charset="utf-8"></script><style id="rootsize">html{font-size:52.05333251953125px !important}</style>
<link id="layuicss-laydate" rel="stylesheet" href="./index_files/laydate.css" media="all"><link id="layuicss-layer" rel="stylesheet" href="./index_files/layer.css" media="all"><link id="layuicss-skincodecss" rel="stylesheet" href="./index_files/code.css" media="all"></head>
<body style="min-height: calc(100% - 1rem); padding-bottom: 1rem; font-size: 16px;">
<div class="" id="showView"><div class="block-div-line"><div class="base-font-32 text-333 ellipsis" style="line-height:0.33rem;height:0.33rem;">郝浩男<span>发起的请假申请&nbsp;&nbsp;</span><div class="rending" style="background-color: #42b24f">通过</div></div><div class="base-font-24 text-999 ellipsis"><span>请假类别：</span>病假</div><div class="base-font-24 text-999 ellipsis">请假开始时间：<span>2022-09-11 14:00</span></div><div class="base-font-24 text-999 ellipsis">请假结束时间：<span>2022-09-11 18:00</span></div><div class="buttonGroup" id="d2447f2a00c841fdbc9347698491f2c8"><a href="details.html"> <button type="button" onclick="window.location.href('details.html')" class="layui-btn layui-btn-warm">详情</button> </a></div> </div><div class="block-div-line"><div class="base-font-32 text-333 ellipsis" style="line-height:0.33rem;height:0.33rem;">郝浩男<span>发起的请假申请&nbsp;&nbsp;</span><div class="rending">已销假</div></div><div class="base-font-24 text-999 ellipsis"><span>请假类别：</span>病假</div><div class="base-font-24 text-999 ellipsis">请假开始时间：<span>2022-03-20 08:30</span></div><div class="base-font-24 text-999 ellipsis">请假结束时间：<span>2022-03-20 14:00</span></div><div class="buttonGroup" id="0b33d4b165564966815d21bc9f8dffde"><button type="button" onclick="detail(this)" class="layui-btn layui-btn-warm">详情</button> </div> </div><div class="block-div-line"><div class="base-font-32 text-333 ellipsis" style="line-height:0.33rem;height:0.33rem;">郝浩男<span>发起的请假申请&nbsp;&nbsp;</span><div class="rending">已销假</div></div><div class="base-font-24 text-999 ellipsis"><span>请假类别：</span>事假</div><div class="base-font-24 text-999 ellipsis">请假开始时间：<span>2022-03-18 15:40</span></div><div class="base-font-24 text-999 ellipsis">请假结束时间：<span>2022-03-18 18:15</span></div><div class="buttonGroup" id="17d48b104f834c7cbde4bb5ced4de8be"><a href='index1.html'><button type="button" onclick=onclick="window.location.href('index1.html')" class="layui-btn layui-btn-warm">详情</button> </a> </div> </div></div>

<div class="weui-loadmore" style="display: none;">
    <i class="weui-loading"></i>
    <span class="weui-loadmore__tips">正在加载</span>
</div>

<div class="nodate-ctn" style="display: none; height: 958px;"><div class="nodate-ctn-out">
        <div class="nodate-ctn-in">
            <div class="nodataImg"><img src="./index_files/nodatapic.png"></div>
            <div class="text-center base-font-28 text-999 margin-top20">暂无数据</div>
        </div>
    </div></div>
<div class="footfixed bg-white">
    <div class="weui-flex twoBtnLine">
        <div class="weui-flex__item"><button type="button" onclick="window.history.go(-1)" class="layui-btn layui-btn-primary">返回</button></div>
        <div class="weui-flex__item"><button type="button" onclick="edit()" class="layui-btn layui-btn-normal">申请</button></div>
        <div class="weui-flex__item"><button type="button" onclick="edit2()" class="layui-btn layui-btn-normal">新申请</button></div>
    </div>
</div>
<script src="./index_files/jquery-2.2.1.min.js.下载"></script>
<script src="./index_files/jquery-weui.js.下载"></script>
<script type="text/javascript" src="./index_files/fastclick.js.下载"></script>
<script src="./index_files/layui.all.js.下载" charset="utf-8"></script>
<script src="./index_files/common.js.下载" charset="utf-8"></script>
<script type="text/javascript" src="./index_files/jweixin-1.4.0.js.下载" charset="utf-8"></script>
<script>
    let page = 1;
    let limit =10;
    let loading = false;
    $('.weui-loadmore').hide();
    $(".nodate-ctn").css("height", document.body.scrollHeight - 50);
    layui.define(['jquery', 'form','baseUtil'], function(exports){
        let $ = layui.jquery;
        let form = layui.form;
        let baseUtil=layui.baseUtil;

        let key = getRequestParams('key');

        $(function () {
            FastClick.attach(document.body);
            initData();
            initListener();
        });

        function initListener() {
            //初始化滚动加载
            $(document.body).infinite().on("infinite", function () {
                if (loading) return;
                loading = true;
                $('.weui-loadmore').show();
                setTimeout(function () {
                    page++;
                    postData(2);
                }, 1000);
            });
        }
        function initData() {
            postData(1);
        }

        let html = "";
        function postData(flag) {
            if (flag === 1) {
                $(document.body).infinite(100);
            }
            //获取岗位审核列表
            baseUtil.doPost('/work/asd/askForLeave/findVoPageByPosition.do?key=' + key, {'pageNum': page, 'pageSize': limit}, function (page) {
                if (page.pageNum * page.pageSize >= page.pageTotal) {
                    $(document.body).destroyInfinite();
                }
                if (page.data != null && page.data.length > 0) {
                    $.each(page.data, function (i, item) {
                        let optionhtml = '<button type="button" onclick="detail(this)" class="layui-btn layui-btn-warm">详情</button>';
                        if(item.status === '-1'){
                            optionhtml += '<button type="button" onclick="edit2(this)" class="layui-btn layui-btn-normal">重新申请</button>';
                        }
                        let startTime  =  "" ;
                        let endTime  = "" ;
                        if(item.startTime == null || item.startTime == ""){
                            startTime = item.startTime
                        }else {
                            startTime = item.startTime.substring(0, 16)
                        }
                        if(item.endTime == null || item.endTime == ""){
                            endTime = item.endTime
                        }else {
                            endTime = item.endTime.substring(0, 16)
                        }
                        var leaveType;
                        if (item.askForLeaveType==='0'){
                            leaveType = "病假";
                        }else if(item.askForLeaveType==='1'){
                            leaveType = "事假";
                        }else{
                            leaveType = "其他";
                        }
                        var status;
                        if (item.status === '4'){
                            status = "不通过";
                        }else if(item.status === '0'){
                            status = "审核中";
                        } else if (item.status === '-1') {
                            status = '待申请';
                        } else {
                            if (item.isReportBack == '0'){
                                // 比较时间
                                if (Number(new Date(getNowDate() + " " + item.endTime.substring(11, 19)).getTime()) >= Number(new Date(item.endTime.substring(0, 19)).getTime())){
                                    status = "逾期未销假";
                                } else {
                                    status = "通过";
                                }
                            } else {
                                status = "已销假";
                            }
                        }
                        html += '<div class="block-div-line">' +
                            '<div class="base-font-32 text-333 ellipsis" style="line-height:0.33rem;height:0.33rem;">'+ item.name + '<span>发起的请假申请&nbsp;&nbsp;</span><div class="rending">'+ status +'</div></div>' +
                            '<div class="base-font-24 text-999 ellipsis"><span>请假类别：</span>' + leaveType + '</div>' +
                            '<div class="base-font-24 text-999 ellipsis">请假开始时间：<span>' + startTime +'</span></div>' +
                            '<div class="base-font-24 text-999 ellipsis">请假结束时间：<span>' + endTime + '</span></div>' +
                            '<div class="buttonGroup" id="' + item.id + '">' + optionhtml +
                            ' </div>' +
                            ' </div>';
                    });
                }

                if (isBlank(html)) {
                    $('.nodate-ctn').show();
                } else {
                    if (flag === 1) {
                        $("#showView").html(html);
                        $(document.body).pullToRefreshDone();
                    } else if (flag === 2) {
                        loading = false;
                        $(".weui-loadmore").hide();
                        $("#showView").html(html);
                    }
                }
            });
        }

        //查看
        window.detail=function(obj){
            //获取父级div
            var id = obj.parentNode.id;
            window.location.href = '/phone/askForLeave/askForLeaveDetailSee.html?id=' + id + '&key=' + key;
        }

        //认定或者重新认定
        window.edit=function(obj){
            if (isNotBlank(obj)) {
                var id = obj.parentNode.id;
                window.location.href = '/phone/askForLeave/askForLeaveAdd.html?key=' + key + '&id=' + id;
            }else {
                window.location.href = '/phone/askForLeave/askForLeaveAdd.html?key=' + key;
            }
        }

        //认定或者重新认定
        window.edit2=function(obj){
            var id = (obj && obj.parentNode.id)||"";
            let ua = window.navigator.userAgent.toLowerCase();
            if (ua.match(/micromessenger/i) == 'micromessenger') { // 微信内置浏览器
                jWeixin.miniProgram.getEnv(function (res){
                    if (res.miniprogram) {
                        //小程序内
                        jWeixin.miniProgram.navigateTo({
                            url: '/pages/askForLeave/input?key=' + key + '&id=' + id
                        })
                    } else {
                        //其他环境
                        baseUtil.msg("请在微信小程序内打开");
                    }
                })
            }else {
                edit(obj)
            }
        }

    });

</script>


<div class="layui-layer-move"></div></body></html>
